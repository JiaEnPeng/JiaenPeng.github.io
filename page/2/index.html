<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh_CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="keywords" content="jiaen,pengjiaen,家恩,彭家恩,弈心">
<meta property="og:type" content="website">
<meta property="og:title" content="弈心">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="弈心">
<meta property="og:locale" content="zh_CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="弈心">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/">





  <title>弈心</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh_CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">弈心</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">个人博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/19/第二题-二数之和/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="弈心">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="弈心">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/19/第二题-二数之和/" itemprop="url">第二题 二数之和</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-19T11:23:00+08:00">
                2017-10-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h1><p>You are given two non-empty linked lists representing two non-negative integers. The digits are stored in reverse order and each of their nodes contain a single digit. Add the two numbers and return it as a linked list.</p>
<p>You may assume the two numbers do not contain any leading zero, except the number 0 itself.</p>
<p>给定两个非空的非负整数集的链表，现要求将两个链表元素相加，相加得到的数字以相反的顺序存储到新链表中返回，并保证每个节点包含一位数。</p>
<p>你可以假设这两个数字不包含任何前导零，除了数字0本身。</p>
<p>Input: (2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4)<br>Output: 7 -&gt; 0 -&gt; 8</p>
<h1 id="思考："><a href="#思考：" class="headerlink" title="思考："></a>思考：</h1><p>题目不难，但有些细节需要考虑到，比如：</p>
<p>1、两个链表长度不一样</p>
<p>2、遍历完链表求和完毕后，如果最后和不为0，需要申请额外的节点进行保存。</p>
<h1 id="代码实现："><a href="#代码实现：" class="headerlink" title="代码实现："></a>代码实现：</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     struct ListNode *next;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">struct ListNode* <span class="title">addTwoNumbers</span><span class="params">(struct ListNode* l1, struct ListNode* l2)</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span>* <span class="title">p</span> = <span class="title">l1</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span>* <span class="title">q</span> = <span class="title">l2</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span>* <span class="title">last</span> = <span class="title">NULL</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span>* <span class="title">node</span> = <span class="title">NULL</span>;</span></span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(!l1 || !l2) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        sum += p-&gt;val + q-&gt;val;</span><br><span class="line">        p-&gt;val = sum % <span class="number">10</span>;</span><br><span class="line">        last = p;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">        q = q-&gt;next;</span><br><span class="line">        sum = sum / <span class="number">10</span>;</span><br><span class="line">    &#125;<span class="keyword">while</span>(p &amp;&amp; q);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(p) &#123;</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            sum += p-&gt;val;</span><br><span class="line">            p-&gt;val = sum % <span class="number">10</span>;</span><br><span class="line">            last = p;</span><br><span class="line">            p = p-&gt;next;</span><br><span class="line">            sum = sum / <span class="number">10</span>;</span><br><span class="line">        &#125;<span class="keyword">while</span>(p);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(q) &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            sum += q-&gt;val;</span><br><span class="line">            q-&gt;val = sum % <span class="number">10</span>;</span><br><span class="line">            last-&gt;next = q;</span><br><span class="line">            last = q;</span><br><span class="line">            q = q-&gt;next;</span><br><span class="line">            sum = sum / <span class="number">10</span>;</span><br><span class="line">        &#125;<span class="keyword">while</span>(q);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (sum != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            node = (struct ListNode*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(struct ListNode));</span><br><span class="line">            <span class="keyword">if</span>(!node) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            node-&gt;val = sum % <span class="number">10</span>;</span><br><span class="line">            sum = sum / <span class="number">10</span>;</span><br><span class="line">            node-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">            last-&gt;next = node;</span><br><span class="line">            last = node;</span><br><span class="line">        &#125;<span class="keyword">while</span>(sum);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> l1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="验证结果"><a href="#验证结果" class="headerlink" title="验证结果"></a>验证结果</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Run Code Result: </span><br><span class="line">Your input </span><br><span class="line">[2,4,3]</span><br><span class="line">[5,6,4]</span><br><span class="line">Your answer </span><br><span class="line">[7,0,8]</span><br><span class="line">Expected answer </span><br><span class="line">[7,0,8]</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/19/第三题-求最大子字符串的长度/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="弈心">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="弈心">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/19/第三题-求最大子字符串的长度/" itemprop="url">第三题 求最大子字符串的长度</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-19T11:22:57+08:00">
                2017-10-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>Given a string, find the length of the longest substring without repeating characters.</p>
<p>Examples:</p>
<p>Given “abcabcbb”, the answer is “abc”, which the length is 3.</p>
<p>Given “bbbbb”, the answer is “b”, with the length of 1.</p>
<p>Given “pwwkew”, the answer is “wke”, with the length of 3. Note that the answer must be a substring, “pwke” is a subsequence and not a substring.</p>
<p>给定一个字符串，找到最长的子串的长度没有重复字符。<br>实例：<br>“abcabcbb”，答案是“ABC”，它的长度是3。<br>“bbbbb”，答案是“B”，长度为1。<br>“pwwkew”，答案是“wke”，长度为3。注意，答案必须是一个字符串，“pwke”不是子字符串。</p>
<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>通过循环遍历，即可找到最大的没有重复字符的子串。</p>
<h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(<span class="keyword">char</span>* s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> maxlen = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="built_in">strlen</span>(s);</span><br><span class="line">    <span class="keyword">char</span>* end = s + len;</span><br><span class="line">    <span class="keyword">char</span> option[<span class="number">256</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> curlen = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span>* p;</span><br><span class="line">    <span class="keyword">char</span>* q;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(len == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(p = s; *p != <span class="string">'\0'</span>; p++) &#123;</span><br><span class="line">        <span class="built_in">memset</span>(option, <span class="number">0</span>, <span class="number">256</span>);</span><br><span class="line">        option[(<span class="keyword">int</span>)(*p)] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(q = p + <span class="number">1</span>; *q != <span class="string">'\0'</span>; q++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(option[(<span class="keyword">int</span>)(*q)] == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            option[(<span class="keyword">int</span>)(*q)] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        curlen = q - p;</span><br><span class="line">        <span class="keyword">if</span>(curlen &gt; maxlen) &#123;</span><br><span class="line">            maxlen = curlen;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(maxlen &gt; end - p) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> maxlen;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="验证结果"><a href="#验证结果" class="headerlink" title="验证结果"></a>验证结果</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Run Code Result: </span><br><span class="line"> </span><br><span class="line">Your input</span><br><span class="line"> </span><br><span class="line">&quot;abcabcbb&quot;</span><br><span class="line"></span><br><span class="line">Your answer</span><br><span class="line"> </span><br><span class="line">3</span><br><span class="line">Expected answer</span><br><span class="line"> </span><br><span class="line">3</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/19/第七题-整数翻转/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="弈心">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="弈心">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/19/第七题-整数翻转/" itemprop="url">第七题 整数翻转</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-19T11:22:54+08:00">
                2017-10-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>反转整数</p>
<p>Example1: x = 123, return 321<br>Example2: x = -123, return -321</p>
<p><strong>备注：</strong></p>
<p>假定输入为32位有符号整数。 当反转的整数溢出时，你的函数应该返回0。</p>
<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>这题应该算是比较简单的一道题了，只需要逐一取出整数的每一位赋值给新整数的对应反转位即可。</p>
<p>这里判定整数有没有溢出的方法：将乘10之后的数字与乘之前的数字进行除法运算，如果结果不等于10，那肯定是溢出了。</p>
<h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">reverse</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(x) &#123;</span><br><span class="line">        tmp = result * <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">if</span>(result != <span class="number">0</span> &amp;&amp; tmp / result != <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        result = tmp;</span><br><span class="line">        result += x % <span class="number">10</span>;</span><br><span class="line">        x = x / <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="验证结果"><a href="#验证结果" class="headerlink" title="验证结果"></a>验证结果</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Your input：</span><br><span class="line">-5698</span><br><span class="line">Your answer：</span><br><span class="line">-8965</span><br><span class="line">Expected answer：</span><br><span class="line">-8965</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/19/第一题-二数之和/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="弈心">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="弈心">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/19/第一题-二数之和/" itemprop="url">第一题 二数之和</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-19T11:22:51+08:00">
                2017-10-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>Given an array of integers, return indices of the two numbers such that they add up to a specific target.</p>
<p>You may assume that each input would have exactly one solution, and you may not use the same element twice.</p>
<p>给定一个整数数组，返回两个数的索引，使它们相加为一个特定的目标。<br>您可以假设每个输入都有一个解决方案，不能两次使用同一个元素。</p>
<p>样例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Given nums = [2, 7, 11, 15], target = 9,</span><br><span class="line"></span><br><span class="line">Because nums[0] + nums[1] = 2 + 7 = 9,</span><br><span class="line">return [0, 1].</span><br></pre></td></tr></table></figure>
<h1 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h1><p>通过分析，可以很快的想到利用两个变量，循环遍历所有的元素，直到找到两个元素的和，与期望查找的目标相等，那么就完成。</p>
<h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Note: The returned array must be malloced, assume caller calls free().</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span>* <span class="title">twoSum</span><span class="params">(<span class="keyword">int</span>* nums, <span class="keyword">int</span> numsSize, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span>* indices = (<span class="keyword">int</span>*) <span class="built_in">malloc</span>(<span class="number">2</span> * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">    <span class="keyword">if</span>(!indices) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt;= numsSize - <span class="number">2</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = i + <span class="number">1</span>; j &lt;= numsSize - <span class="number">1</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] + nums[j] == target) &#123;</span><br><span class="line">                indices[<span class="number">0</span>] = i;</span><br><span class="line">                indices[<span class="number">1</span>] = j;</span><br><span class="line">                <span class="keyword">goto</span> finish;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">finish:</span><br><span class="line">    <span class="keyword">return</span> indices;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="验证结果"><a href="#验证结果" class="headerlink" title="验证结果"></a>验证结果</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Run Code Result:</span><br><span class="line"></span><br><span class="line">Your input</span><br><span class="line"></span><br><span class="line">[3,2,4,8,45,3,67,54,3,7,9]</span><br><span class="line">63</span><br><span class="line">Your answer</span><br><span class="line"></span><br><span class="line">[7,10]</span><br><span class="line">Expected answer</span><br><span class="line"></span><br><span class="line">[7,10]</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/19/求字符串的最大回文子串/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="弈心">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="弈心">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/19/求字符串的最大回文子串/" itemprop="url">求字符串的最大回文子串</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-19T11:22:47+08:00">
                2017-10-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>Given a string s, find the longest palindromic substring in s. You may assume that the maximum length of s is 1000.</p>
<p>给定一个字符串s，在s中找到最长的回文子串。您可以假定s的最大长度为1000。</p>
<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>通过遍历字符串，分别找出长度为偶数的子串和长度为奇数的子串，通过比较，最终得到最长的回文子串。</p>
<h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">longestPalindrome</span><span class="params">(<span class="keyword">char</span>* s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="built_in">strlen</span>(s);</span><br><span class="line">    <span class="keyword">char</span>* res = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> maxlen = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> curlen = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(len == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    res = (<span class="keyword">char</span>*)<span class="built_in">malloc</span>(<span class="number">1001</span>);</span><br><span class="line">    <span class="keyword">if</span>(!res) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;len; i++) &#123;</span><br><span class="line">        flag = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">1</span>; j&lt;len; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>((i-j+<span class="number">1</span> &lt; <span class="number">0</span>) || (i+j == len)) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(s[i-j+<span class="number">1</span>] == s[i+j]) &#123;</span><br><span class="line">                curlen = <span class="number">2</span>*j;</span><br><span class="line">                <span class="keyword">if</span>(curlen &gt; maxlen) &#123;</span><br><span class="line">                    maxlen = curlen;</span><br><span class="line">                    <span class="built_in">memcpy</span>(res, s+i-j+<span class="number">1</span>, curlen);</span><br><span class="line">                    res[curlen] = <span class="string">'\0'</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        curlen = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">1</span>; j&lt;len; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>((i-j &lt; <span class="number">0</span>) || (i+j == len)) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(s[i-j] == s[i+j]) &#123;</span><br><span class="line">                flag = <span class="number">1</span>;</span><br><span class="line">                curlen = <span class="number">2</span>*j+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(curlen &gt; maxlen) &#123;                    </span><br><span class="line">                    maxlen = curlen;</span><br><span class="line">                    <span class="built_in">memcpy</span>(res, s+i-j, curlen);</span><br><span class="line">                    res[curlen] = <span class="string">'\0'</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(flag != <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(curlen &gt; maxlen) &#123;</span><br><span class="line">                maxlen = curlen;</span><br><span class="line">                <span class="built_in">memcpy</span>(res, s+i, curlen);</span><br><span class="line">                res[curlen] = <span class="string">'\0'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="验证结果"><a href="#验证结果" class="headerlink" title="验证结果"></a>验证结果</h1><h2 id="Run-Code-Result"><a href="#Run-Code-Result" class="headerlink" title="Run Code Result:"></a>Run Code Result:</h2><h3 id="Input："><a href="#Input：" class="headerlink" title="Input："></a>Input：</h3><p><code>&quot;babad&quot;</code></p>
<h3 id="Output："><a href="#Output：" class="headerlink" title="Output："></a>Output：</h3><p><code>&quot;bab&quot;</code></p>
<p>验证通过</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/19/是谁在试探我的root密码/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="弈心">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="弈心">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/19/是谁在试探我的root密码/" itemprop="url">是谁在试探我的root密码</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-19T11:22:44+08:00">
                2017-10-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>最近我的Centos服务器出现了大量的日志文件，占用了很大一部分磁盘空间，经过分析发现，原来是/var/log/secure占用了很大一部分，secure文件是用来记录系统用户登录信息的，为何会有如此多的日志呢？会不会是有人在攻击我的22端口？</p>
<h2 id="secure文件分析"><a href="#secure文件分析" class="headerlink" title="secure文件分析"></a>secure文件分析</h2><p>通过查看secure文件可以看到如下一些信息：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost log]# cat secure </span><br><span class="line">May  2 18:50:13 localhost sshd[3210]: Failed password for invalid user admin from 31.207.47.55 port 54349 ssh2</span><br><span class="line">May  2 18:50:13 localhost sshd[3210]: pam_unix(sshd:auth): check pass; user unknown</span><br><span class="line">May  2 18:50:15 localhost sshd[3210]: Failed password for invalid user admin from 31.207.47.55 port 54349 ssh2</span><br><span class="line">May  2 18:50:15 localhost sshd[3210]: pam_unix(sshd:auth): check pass; user unknown</span><br><span class="line">May  2 18:50:17 localhost sshd[3210]: Failed password for invalid user admin from 31.207.47.55 port 54349 ssh2</span><br><span class="line">May  2 18:50:17 localhost sshd[3210]: pam_unix(sshd:auth): check pass; user unknown</span><br><span class="line">May  2 18:50:19 localhost sshd[3210]: Failed password for invalid user admin from 31.207.47.55 port 54349 ssh2</span><br><span class="line">May  2 18:50:19 localhost sshd[3210]: pam_unix(sshd:auth): check pass; user unknown</span><br><span class="line">May  2 18:50:21 localhost sshd[3210]: Failed password for invalid user admin from 31.207.47.55 port 54349 ssh2</span><br><span class="line">May  2 18:50:22 localhost sshd[3210]: Connection closed by 31.207.47.55 [preauth]</span><br><span class="line">May  2 18:50:22 localhost sshd[3210]: PAM 4 more authentication failures; logname= uid=0 euid=0 tty=ssh ruser= rhost=31.207.47.55</span><br><span class="line">May  2 18:50:22 localhost sshd[3210]: PAM service(sshd) ignoring max retries; 5 &gt; 3</span><br><span class="line">May  2 18:50:24 localhost sshd[4793]: Invalid user admin from 31.207.47.55</span><br><span class="line">May  2 18:50:24 localhost sshd[4793]: input_userauth_request: invalid user admin [preauth]</span><br><span class="line">May  2 18:50:24 localhost sshd[4793]: pam_unix(sshd:auth): check pass; user unknown</span><br><span class="line">May  2 18:50:24 localhost sshd[4793]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=31.207.47.55</span><br><span class="line">May  2 18:50:26 localhost sshd[4793]: Failed password for invalid user admin from 31.207.47.55 port 45200 ssh2</span><br><span class="line">May  2 18:50:26 localhost sshd[4793]: pam_unix(sshd:auth): check pass; user unknown</span><br><span class="line">May  2 18:50:28 localhost sshd[4793]: Failed password for invalid user admin from 31.207.47.55 port 45200 ssh2</span><br><span class="line">......（省略N行）</span><br></pre></td></tr></table></figure></p>
<p>由此可知，大量的Failed password登录信息，占用了绝大部分的secure文件，由此判定，有人在利用我的22端口进行攻击，试图探测我的root账户密码。secure文件中，会记录那些登录者的IP，因此，找出这些登录失败的IP，记录那些尝试次数过多的IP，用iptables规则将其加入黑名单中即可避免再次被攻击。</p>
<h2 id="查找尝试登陆次数最多的十个IP"><a href="#查找尝试登陆次数最多的十个IP" class="headerlink" title="查找尝试登陆次数最多的十个IP"></a>查找尝试登陆次数最多的十个IP</h2><p>通过grep命令，可以过滤那些上登录失败的信息，如下：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost log]# cat secure | grep "Failed password for root"</span><br><span class="line">May  3 18:22:57 localhost sshd[17557]: Failed password for root from 203.151.96.143 port 40401 ssh2</span><br><span class="line">May  3 18:23:00 localhost sshd[17560]: Failed password for root from 203.151.96.143 port 40988 ssh2</span><br><span class="line">May  3 18:23:02 localhost sshd[17563]: Failed password for root from 203.151.96.143 port 41583 ssh2</span><br><span class="line">May  3 18:23:05 localhost sshd[17566]: Failed password for root from 203.151.96.143 port 42193 ssh2</span><br><span class="line">May  3 18:23:07 localhost sshd[17569]: Failed password for root from 203.151.96.143 port 42907 ssh2</span><br><span class="line">May  3 18:23:10 localhost sshd[17572]: Failed password for root from 203.151.96.143 port 43420 ssh2</span><br><span class="line">May  3 18:23:13 localhost sshd[17575]: Failed password for root from 203.151.96.143 port 44089 ssh2</span><br><span class="line">May  3 18:23:15 localhost sshd[17578]: Failed password for root from 203.151.96.143 port 44698 ssh2</span><br><span class="line">May  3 18:23:18 localhost sshd[17581]: Failed password for root from 203.151.96.143 port 45344 ssh2</span><br><span class="line">May  3 18:23:21 localhost sshd[17584]: Failed password for root from 203.151.96.143 port 46013 ssh2</span><br><span class="line">......（省略N行）</span><br></pre></td></tr></table></figure></p>
<p>通过上述结果，采用awk命令，输出所有的IP，如下：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost log]# cat secure | grep "Failed password for root" | awk '&#123;print $11&#125;'</span><br><span class="line">203.151.96.143</span><br><span class="line">59.63.166.81</span><br><span class="line">59.63.166.81</span><br><span class="line">59.63.166.81</span><br><span class="line">59.63.166.81</span><br><span class="line">59.63.166.81</span><br><span class="line">59.63.166.81</span><br><span class="line">59.63.166.81</span><br><span class="line">59.63.166.81</span><br><span class="line">59.63.166.81</span><br><span class="line">59.63.166.81</span><br><span class="line">59.63.166.81</span><br><span class="line">......（省略N行）</span><br></pre></td></tr></table></figure></p>
<p>由于IP条目过多，因此将相同的IP进行合并，并输出每个IP出现的次数，依然采用awk命令进行，如下：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost log]# cat secure | grep "Failed password for root" | awk '&#123;print $11&#125;'| awk '&#123;arr[$1]++&#125;;END&#123;for(i in arr)&#123;print i , arr[i] &#125;&#125;'</span><br><span class="line">123.103.112.3 9</span><br><span class="line">218.109.241.50 6</span><br><span class="line">122.241.57.200 6</span><br><span class="line">94.245.191.50 6</span><br><span class="line">94.51.130.236 6</span><br><span class="line">113.160.159.28 6</span><br><span class="line">113.205.86.62 6</span><br><span class="line">91.197.232.11 27</span><br><span class="line">222.187.86.51 12</span><br><span class="line">125.123.85.75 6</span><br><span class="line">185.70.186.150 5</span><br><span class="line">182.44.54.100 6</span><br><span class="line">91.236.116.77 14</span><br><span class="line">185.165.29.45 6</span><br><span class="line">123.96.136.101 6</span><br><span class="line">193.213.204.133 6</span><br><span class="line">211.226.197.35 6</span><br><span class="line">185.165.29.47 6</span><br><span class="line">111.12.86.78 6</span><br><span class="line">89.114.125.31 6</span><br><span class="line">......（省略N行）</span><br></pre></td></tr></table></figure></p>
<p>为了找出前10名出现次数最多的IP，因此需要对结果进行排序，采用sort命令按IP出现次数逆序排序，并用head命令输出前10，如下：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost log]# cat secure | grep "Failed password for root" | awk '&#123;print $11&#125;'| awk '&#123;arr[$1]++&#125;;END&#123;for(i in arr)&#123;print i , arr[i] &#125;&#125;'| sort -n -r -k 2  | head -n 10</span><br><span class="line">59.63.166.81 16159</span><br><span class="line">203.151.96.143 1993</span><br><span class="line">61.135.193.158 698</span><br><span class="line">202.109.143.117 255</span><br><span class="line">82.102.15.246 71</span><br><span class="line">31.207.47.50 63</span><br><span class="line">91.211.1.100 54</span><br><span class="line">31.207.47.55 54</span><br><span class="line">91.113.148.130 44</span><br><span class="line">183.60.158.40 43</span><br><span class="line">......（省略N行）</span><br></pre></td></tr></table></figure></p>
<p>由此可以得到，原来是这些人在攻击我的服务器，想要获取我的root账户的密码。</p>
<h2 id="用iptables将那些攻击者加入黑名单"><a href="#用iptables将那些攻击者加入黑名单" class="headerlink" title="用iptables将那些攻击者加入黑名单"></a>用iptables将那些攻击者加入黑名单</h2><p>通过上述查找过程，已经找出是谁在攻击我了，因此，需要将他们加入到黑名单里面，iptables命令如下：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/*添加规则*/</span><br><span class="line">[root@localhost log]#iptables -I INPUT -s 59.63.166.81 -j DROP</span><br><span class="line">[root@localhost log]#iptables -I INPUT -s 203.151.96.143 -j DROP</span><br><span class="line">[root@localhost log]#iptables -I INPUT -s 61.135.193.158 -j DROP</span><br><span class="line">[root@localhost log]#iptables -I INPUT -s 202.109.143.117 -j DROP</span><br><span class="line">/*保存规则*/</span><br><span class="line">[root@localhost log]#service iptables save</span><br></pre></td></tr></table></figure></p>
<p>至此，大功告成了</p>
<p>##总结</p>
<p>熟悉了常用的awk/grep/sort等命令对文本进行分析。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/19/怎样获取发送skb的进程PID/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="弈心">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="弈心">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/19/怎样获取发送skb的进程PID/" itemprop="url">怎样获取发送skb的进程PID</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-19T11:22:41+08:00">
                2017-10-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>今天有同事问我，如何能够获得通过sk_buff得到发送此数据包的进程PID呢？仔细想了想，之前没遇到过此需求，所以，不好直接回复，由此，进行了以下的探索。</p>
<h1 id="sk-buff"><a href="#sk-buff" class="headerlink" title="sk_buff"></a>sk_buff</h1><p>sk_buff全名为socket buffers，简称skb，中文名字叫套接字缓存。它作为网络数据包的存放地点，使得协议栈中每个层都可以对数据进行操作，从而实现了数据包自底向上的传递。该结构维护一个收到的或者要发送的网络包。但其本身并不包含存放网络包的数据的存储区。存储区是另外单独分配的内存空间，但该结构说明了如何访问存储区空间，如何维护多个存储区空间以及存储网络包解析的成果。</p>
<p>所有的sk_buff是通过一个双向链表进行维护的。需要说明的是该双向链表中的一个元素是struct sk_buff_head类型。它相当于该双向链表的表头，其中有锁，链表元素个数等维护链表的相关信息。链表中其它的元素都是sk_buff类型。</p>
<p>更多关于sk_buff的介绍，请自行查找相关资料。</p>
<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>既然需要得到发送skb的进程PID，那么skb中是否保存了进程相关的信息呢，通过分析sk_buff的结构，并未发现在哪保存了进程相关的。sk_buff结构如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sk_buff</span> &#123;</span></span><br><span class="line">	<span class="comment">/* These two members must be first. */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sk_buff</span>		*<span class="title">next</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sk_buff</span>		*<span class="title">prev</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">union</span> &#123;</span><br><span class="line">		<span class="keyword">ktime_t</span>		tstamp;</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">skb_mstamp</span> <span class="title">skb_mstamp</span>;</span></span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sock</span>		*<span class="title">sk</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">net_device</span>	*<span class="title">dev</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * This is the control buffer. It is free to use for every</span></span><br><span class="line"><span class="comment">	 * layer. Please put your private variables there. If you</span></span><br><span class="line"><span class="comment">	 * want to keep them across layers you have to do a skb_clone()</span></span><br><span class="line"><span class="comment">	 * first. This is owned by whoever has the skb queued ATM.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">char</span>			cb[<span class="number">48</span>] __aligned(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span>		_skb_refdst;</span><br><span class="line">	<span class="keyword">void</span>			(*destructor)(struct sk_buff *skb);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_XFRM</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span>	<span class="title">sec_path</span>	*<span class="title">sp</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(CONFIG_NF_CONNTRACK) || defined(CONFIG_NF_CONNTRACK_MODULE)</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">nf_conntrack</span>	*<span class="title">nfct</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> IS_ENABLED(CONFIG_BRIDGE_NETFILTER)</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">nf_bridge_info</span>	*<span class="title">nf_bridge</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span>		len,</span><br><span class="line">				data_len;</span><br><span class="line">	__u16			mac_len,</span><br><span class="line">				hdr_len;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Following fields are _not_ copied in __copy_skb_header()</span></span><br><span class="line"><span class="comment">	 * Note that queue_mapping is here mostly to fill a hole.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	kmemcheck_bitfield_begin(flags1);</span><br><span class="line">	__u16			queue_mapping;</span><br><span class="line">	__u8			cloned:<span class="number">1</span>,</span><br><span class="line">				nohdr:<span class="number">1</span>,</span><br><span class="line">				fclone:<span class="number">2</span>,</span><br><span class="line">				peeked:<span class="number">1</span>,</span><br><span class="line">				head_frag:<span class="number">1</span>,</span><br><span class="line">				xmit_more:<span class="number">1</span>;</span><br><span class="line">	<span class="comment">/* one bit hole */</span></span><br><span class="line">	kmemcheck_bitfield_end(flags1);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* fields enclosed in headers_start/headers_end are copied</span></span><br><span class="line"><span class="comment">	 * using a single memcpy() in __copy_skb_header()</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="comment">/* private: */</span></span><br><span class="line">	__u32			headers_start[<span class="number">0</span>];</span><br><span class="line">	<span class="comment">/* public: */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* if you move pkt_type around you also must adapt those constants */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __BIG_ENDIAN_BITFIELD</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PKT_TYPE_MAX	(7 &lt;&lt; 5)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PKT_TYPE_MAX	7</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PKT_TYPE_OFFSET()	offsetof(struct sk_buff, __pkt_type_offset)</span></span><br><span class="line"></span><br><span class="line">	__u8			__pkt_type_offset[<span class="number">0</span>];</span><br><span class="line">	__u8			pkt_type:<span class="number">3</span>;</span><br><span class="line">	__u8			pfmemalloc:<span class="number">1</span>;</span><br><span class="line">	__u8			ignore_df:<span class="number">1</span>;</span><br><span class="line">	__u8			nfctinfo:<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">	__u8			nf_trace:<span class="number">1</span>;</span><br><span class="line">	__u8			ip_summed:<span class="number">2</span>;</span><br><span class="line">	__u8			ooo_okay:<span class="number">1</span>;</span><br><span class="line">	__u8			l4_hash:<span class="number">1</span>;</span><br><span class="line">	__u8			sw_hash:<span class="number">1</span>;</span><br><span class="line">	__u8			wifi_acked_valid:<span class="number">1</span>;</span><br><span class="line">	__u8			wifi_acked:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	__u8			no_fcs:<span class="number">1</span>;</span><br><span class="line">	<span class="comment">/* Indicates the inner headers are valid in the skbuff. */</span></span><br><span class="line">	__u8			encapsulation:<span class="number">1</span>;</span><br><span class="line">	__u8			encap_hdr_csum:<span class="number">1</span>;</span><br><span class="line">	__u8			csum_valid:<span class="number">1</span>;</span><br><span class="line">	__u8			csum_complete_sw:<span class="number">1</span>;</span><br><span class="line">	__u8			csum_level:<span class="number">2</span>;</span><br><span class="line">	__u8			csum_bad:<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_IPV6_NDISC_NODETYPE</span></span><br><span class="line">	__u8			ndisc_nodetype:<span class="number">2</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	__u8			ipvs_property:<span class="number">1</span>;</span><br><span class="line">	__u8			inner_protocol_type:<span class="number">1</span>;</span><br><span class="line">	<span class="comment">/* 4 or 6 bit hole */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_NET_SCHED</span></span><br><span class="line">	__u16			tc_index;	<span class="comment">/* traffic control index */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_NET_CLS_ACT</span></span><br><span class="line">	__u16			tc_verd;	<span class="comment">/* traffic control verdict */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">union</span> &#123;</span><br><span class="line">		__wsum		csum;</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">			__u16	csum_start;</span><br><span class="line">			__u16	csum_offset;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;;</span><br><span class="line">	__u32			priority;</span><br><span class="line">	<span class="keyword">int</span>			skb_iif;</span><br><span class="line">	__u32			hash;</span><br><span class="line">	__be16			vlan_proto;</span><br><span class="line">	__u16			vlan_tci;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_NET_RX_BUSY_POLL</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span>	napi_id;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_NETWORK_SECMARK</span></span><br><span class="line">	__u32			secmark;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="keyword">union</span> &#123;</span><br><span class="line">		__u32		mark;</span><br><span class="line">		__u32		dropcount;</span><br><span class="line">		__u32		reserved_tailroom;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">union</span> &#123;</span><br><span class="line">		__be16		inner_protocol;</span><br><span class="line">		__u8		inner_ipproto;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	__u16			inner_transport_header;</span><br><span class="line">	__u16			inner_network_header;</span><br><span class="line">	__u16			inner_mac_header;</span><br><span class="line"></span><br><span class="line">	__be16			protocol;</span><br><span class="line">	__u16			transport_header;</span><br><span class="line">	__u16			network_header;</span><br><span class="line">	__u16			mac_header;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* private: */</span></span><br><span class="line">	__u32			headers_end[<span class="number">0</span>];</span><br><span class="line">	<span class="comment">/* public: */</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* These elements must be at the end, see alloc_skb() for details.  */</span></span><br><span class="line">	<span class="keyword">sk_buff_data_t</span>		tail;</span><br><span class="line">	<span class="keyword">sk_buff_data_t</span>		end;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span>		*head,</span><br><span class="line">				*data;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span>		truesize;</span><br><span class="line">	<span class="keyword">atomic_t</span>		users;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>通过分析sk_buff结构，可以得到此sk_buff是由哪个sock发送的，那么，是否sock里面保存了进程相关信息呢？我们可以来看看sock结构：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  *	struct sock - network layer representation of sockets</span></span><br><span class="line"><span class="comment">  *	@__sk_common: shared layout with inet_timewait_sock</span></span><br><span class="line"><span class="comment">  *	@sk_shutdown: mask of %SEND_SHUTDOWN and/or %RCV_SHUTDOWN</span></span><br><span class="line"><span class="comment">  *	@sk_userlocks: %SO_SNDBUF and %SO_RCVBUF settings</span></span><br><span class="line"><span class="comment">  *	@sk_lock:	synchronizer</span></span><br><span class="line"><span class="comment">  *	@sk_rcvbuf: size of receive buffer in bytes</span></span><br><span class="line"><span class="comment">  *	@sk_wq: sock wait queue and async head</span></span><br><span class="line"><span class="comment">  *	@sk_rx_dst: receive input route used by early demux</span></span><br><span class="line"><span class="comment">  *	@sk_dst_cache: destination cache</span></span><br><span class="line"><span class="comment">  *	@sk_dst_lock: destination cache lock</span></span><br><span class="line"><span class="comment">  *	@sk_policy: flow policy</span></span><br><span class="line"><span class="comment">  *	@sk_receive_queue: incoming packets</span></span><br><span class="line"><span class="comment">  *	@sk_wmem_alloc: transmit queue bytes committed</span></span><br><span class="line"><span class="comment">  *	@sk_write_queue: Packet sending queue</span></span><br><span class="line"><span class="comment">  *	@sk_omem_alloc: "o" is "option" or "other"</span></span><br><span class="line"><span class="comment">  *	@sk_wmem_queued: persistent queue size</span></span><br><span class="line"><span class="comment">  *	@sk_forward_alloc: space allocated forward</span></span><br><span class="line"><span class="comment">  *	@sk_napi_id: id of the last napi context to receive data for sk</span></span><br><span class="line"><span class="comment">  *	@sk_ll_usec: usecs to busypoll when there is no data</span></span><br><span class="line"><span class="comment">  *	@sk_allocation: allocation mode</span></span><br><span class="line"><span class="comment">  *	@sk_pacing_rate: Pacing rate (if supported by transport/packet scheduler)</span></span><br><span class="line"><span class="comment">  *	@sk_max_pacing_rate: Maximum pacing rate (%SO_MAX_PACING_RATE)</span></span><br><span class="line"><span class="comment">  *	@sk_sndbuf: size of send buffer in bytes</span></span><br><span class="line"><span class="comment">  *	@sk_flags: %SO_LINGER (l_onoff), %SO_BROADCAST, %SO_KEEPALIVE,</span></span><br><span class="line"><span class="comment">  *		   %SO_OOBINLINE settings, %SO_TIMESTAMPING settings</span></span><br><span class="line"><span class="comment">  *	@sk_no_check_tx: %SO_NO_CHECK setting, set checksum in TX packets</span></span><br><span class="line"><span class="comment">  *	@sk_no_check_rx: allow zero checksum in RX packets</span></span><br><span class="line"><span class="comment">  *	@sk_route_caps: route capabilities (e.g. %NETIF_F_TSO)</span></span><br><span class="line"><span class="comment">  *	@sk_route_nocaps: forbidden route capabilities (e.g NETIF_F_GSO_MASK)</span></span><br><span class="line"><span class="comment">  *	@sk_gso_type: GSO type (e.g. %SKB_GSO_TCPV4)</span></span><br><span class="line"><span class="comment">  *	@sk_gso_max_size: Maximum GSO segment size to build</span></span><br><span class="line"><span class="comment">  *	@sk_gso_max_segs: Maximum number of GSO segments</span></span><br><span class="line"><span class="comment">  *	@sk_lingertime: %SO_LINGER l_linger setting</span></span><br><span class="line"><span class="comment">  *	@sk_backlog: always used with the per-socket spinlock held</span></span><br><span class="line"><span class="comment">  *	@sk_callback_lock: used with the callbacks in the end of this struct</span></span><br><span class="line"><span class="comment">  *	@sk_error_queue: rarely used</span></span><br><span class="line"><span class="comment">  *	@sk_prot_creator: sk_prot of original sock creator (see ipv6_setsockopt,</span></span><br><span class="line"><span class="comment">  *			  IPV6_ADDRFORM for instance)</span></span><br><span class="line"><span class="comment">  *	@sk_err: last error</span></span><br><span class="line"><span class="comment">  *	@sk_err_soft: errors that don't cause failure but are the cause of a</span></span><br><span class="line"><span class="comment">  *		      persistent failure not just 'timed out'</span></span><br><span class="line"><span class="comment">  *	@sk_drops: raw/udp drops counter</span></span><br><span class="line"><span class="comment">  *	@sk_ack_backlog: current listen backlog</span></span><br><span class="line"><span class="comment">  *	@sk_max_ack_backlog: listen backlog set in listen()</span></span><br><span class="line"><span class="comment">  *	@sk_priority: %SO_PRIORITY setting</span></span><br><span class="line"><span class="comment">  *	@sk_cgrp_prioidx: socket group's priority map index</span></span><br><span class="line"><span class="comment">  *	@sk_type: socket type (%SOCK_STREAM, etc)</span></span><br><span class="line"><span class="comment">  *	@sk_protocol: which protocol this socket belongs in this network family</span></span><br><span class="line"><span class="comment">  *	@sk_peer_pid: &amp;struct pid for this socket's peer</span></span><br><span class="line"><span class="comment">  *	@sk_peer_cred: %SO_PEERCRED setting</span></span><br><span class="line"><span class="comment">  *	@sk_rcvlowat: %SO_RCVLOWAT setting</span></span><br><span class="line"><span class="comment">  *	@sk_rcvtimeo: %SO_RCVTIMEO setting</span></span><br><span class="line"><span class="comment">  *	@sk_sndtimeo: %SO_SNDTIMEO setting</span></span><br><span class="line"><span class="comment">  *	@sk_rxhash: flow hash received from netif layer</span></span><br><span class="line"><span class="comment">  *	@sk_txhash: computed flow hash for use on transmit</span></span><br><span class="line"><span class="comment">  *	@sk_filter: socket filtering instructions</span></span><br><span class="line"><span class="comment">  *	@sk_protinfo: private area, net family specific, when not using slab</span></span><br><span class="line"><span class="comment">  *	@sk_timer: sock cleanup timer</span></span><br><span class="line"><span class="comment">  *	@sk_stamp: time stamp of last packet received</span></span><br><span class="line"><span class="comment">  *	@sk_tsflags: SO_TIMESTAMPING socket options</span></span><br><span class="line"><span class="comment">  *	@sk_tskey: counter to disambiguate concurrent tstamp requests</span></span><br><span class="line"><span class="comment">  *	@sk_socket: Identd and reporting IO signals</span></span><br><span class="line"><span class="comment">  *	@sk_user_data: RPC layer private data</span></span><br><span class="line"><span class="comment">  *	@sk_frag: cached page frag</span></span><br><span class="line"><span class="comment">  *	@sk_peek_off: current peek_offset value</span></span><br><span class="line"><span class="comment">  *	@sk_send_head: front of stuff to transmit</span></span><br><span class="line"><span class="comment">  *	@sk_security: used by security modules</span></span><br><span class="line"><span class="comment">  *	@sk_mark: generic packet mark</span></span><br><span class="line"><span class="comment">  *	@sk_classid: this socket's cgroup classid</span></span><br><span class="line"><span class="comment">  *	@sk_cgrp: this socket's cgroup-specific proto data</span></span><br><span class="line"><span class="comment">  *	@sk_write_pending: a write to stream socket waits to start</span></span><br><span class="line"><span class="comment">  *	@sk_state_change: callback to indicate change in the state of the sock</span></span><br><span class="line"><span class="comment">  *	@sk_data_ready: callback to indicate there is data to be processed</span></span><br><span class="line"><span class="comment">  *	@sk_write_space: callback to indicate there is bf sending space available</span></span><br><span class="line"><span class="comment">  *	@sk_error_report: callback to indicate errors (e.g. %MSG_ERRQUEUE)</span></span><br><span class="line"><span class="comment">  *	@sk_backlog_rcv: callback to process the backlog</span></span><br><span class="line"><span class="comment">  *	@sk_destruct: called at sock freeing time, i.e. when all refcnt == 0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sock</span> &#123;</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Now struct inet_timewait_sock also uses sock_common, so please just</span></span><br><span class="line"><span class="comment">	 * don't add nothing before this first member (__sk_common) --acme</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sock_common</span>	__<span class="title">sk_common</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_node			__sk_common.skc_node</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_nulls_node		__sk_common.skc_nulls_node</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_refcnt		__sk_common.skc_refcnt</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_tx_queue_mapping	__sk_common.skc_tx_queue_mapping</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_dontcopy_begin	__sk_common.skc_dontcopy_begin</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_dontcopy_end		__sk_common.skc_dontcopy_end</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_hash			__sk_common.skc_hash</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_portpair		__sk_common.skc_portpair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_num			__sk_common.skc_num</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_dport		__sk_common.skc_dport</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_addrpair		__sk_common.skc_addrpair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_daddr		__sk_common.skc_daddr</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_rcv_saddr		__sk_common.skc_rcv_saddr</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_family		__sk_common.skc_family</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_state		__sk_common.skc_state</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_reuse		__sk_common.skc_reuse</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_reuseport		__sk_common.skc_reuseport</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_ipv6only		__sk_common.skc_ipv6only</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_bound_dev_if		__sk_common.skc_bound_dev_if</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_bind_node		__sk_common.skc_bind_node</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_prot			__sk_common.skc_prot</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_net			__sk_common.skc_net</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_v6_daddr		__sk_common.skc_v6_daddr</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_v6_rcv_saddr	__sk_common.skc_v6_rcv_saddr</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">socket_lock_t</span>		sk_lock;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sk_buff_head</span>	<span class="title">sk_receive_queue</span>;</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * The backlog queue is special, it is always used with</span></span><br><span class="line"><span class="comment">	 * the per-socket spinlock held and requires low latency</span></span><br><span class="line"><span class="comment">	 * access. Therefore we special case it's implementation.</span></span><br><span class="line"><span class="comment">	 * Note : rmem_alloc is in this structure to fill a hole</span></span><br><span class="line"><span class="comment">	 * on 64bit arches, not because its logically part of</span></span><br><span class="line"><span class="comment">	 * backlog.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">		<span class="keyword">atomic_t</span>	rmem_alloc;</span><br><span class="line">		<span class="keyword">int</span>		len;</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">sk_buff</span>	*<span class="title">head</span>;</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">sk_buff</span>	*<span class="title">tail</span>;</span></span><br><span class="line">	&#125; sk_backlog;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sk_rmem_alloc sk_backlog.rmem_alloc</span></span><br><span class="line">	<span class="keyword">int</span>			sk_forward_alloc;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_RPS</span></span><br><span class="line">	__u32			sk_rxhash;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	__u32			sk_txhash;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_NET_RX_BUSY_POLL</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span>		sk_napi_id;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span>		sk_ll_usec;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="keyword">atomic_t</span>		sk_drops;</span><br><span class="line">	<span class="keyword">int</span>			sk_rcvbuf;</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sk_filter</span> __<span class="title">rcu</span>	*<span class="title">sk_filter</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">socket_wq</span> __<span class="title">rcu</span>	*<span class="title">sk_wq</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_XFRM</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">xfrm_policy</span>	*<span class="title">sk_policy</span>[2];</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> 		sk_flags;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">dst_entry</span>	*<span class="title">sk_rx_dst</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">dst_entry</span> __<span class="title">rcu</span>	*<span class="title">sk_dst_cache</span>;</span></span><br><span class="line">	<span class="keyword">spinlock_t</span>		sk_dst_lock;</span><br><span class="line">	<span class="keyword">atomic_t</span>		sk_wmem_alloc;</span><br><span class="line">	<span class="keyword">atomic_t</span>		sk_omem_alloc;</span><br><span class="line">	<span class="keyword">int</span>			sk_sndbuf;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sk_buff_head</span>	<span class="title">sk_write_queue</span>;</span></span><br><span class="line">	kmemcheck_bitfield_begin(flags);</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span>		sk_shutdown  : <span class="number">2</span>,</span><br><span class="line">				sk_no_check_tx : <span class="number">1</span>,</span><br><span class="line">				sk_no_check_rx : <span class="number">1</span>,</span><br><span class="line">				sk_userlocks : <span class="number">4</span>,</span><br><span class="line">				sk_protocol  : <span class="number">8</span>,</span><br><span class="line">				sk_type      : <span class="number">16</span>;</span><br><span class="line">	kmemcheck_bitfield_end(flags);</span><br><span class="line">	<span class="keyword">int</span>			sk_wmem_queued;</span><br><span class="line">	<span class="keyword">gfp_t</span>			sk_allocation;</span><br><span class="line">	u32			sk_pacing_rate; <span class="comment">/* bytes per second */</span></span><br><span class="line">	u32			sk_max_pacing_rate;</span><br><span class="line">	<span class="keyword">netdev_features_t</span>	sk_route_caps;</span><br><span class="line">	<span class="keyword">netdev_features_t</span>	sk_route_nocaps;</span><br><span class="line">	<span class="keyword">int</span>			sk_gso_type;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span>		sk_gso_max_size;</span><br><span class="line">	u16			sk_gso_max_segs;</span><br><span class="line">	<span class="keyword">int</span>			sk_rcvlowat;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span>	        sk_lingertime;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sk_buff_head</span>	<span class="title">sk_error_queue</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">proto</span>		*<span class="title">sk_prot_creator</span>;</span></span><br><span class="line">	<span class="keyword">rwlock_t</span>		sk_callback_lock;</span><br><span class="line">	<span class="keyword">int</span>			sk_err,</span><br><span class="line">				sk_err_soft;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">short</span>		sk_ack_backlog;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">short</span>		sk_max_ack_backlog;</span><br><span class="line">	__u32			sk_priority;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> IS_ENABLED(CONFIG_CGROUP_NET_PRIO)</span></span><br><span class="line">	__u32			sk_cgrp_prioidx;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">pid</span>		*<span class="title">sk_peer_pid</span>;</span></span><br><span class="line">	<span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">cred</span>	*<span class="title">sk_peer_cred</span>;</span></span><br><span class="line">	<span class="keyword">long</span>			sk_rcvtimeo;</span><br><span class="line">	<span class="keyword">long</span>			sk_sndtimeo;</span><br><span class="line">	<span class="keyword">void</span>			*sk_protinfo;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">timer_list</span>	<span class="title">sk_timer</span>;</span></span><br><span class="line">	<span class="keyword">ktime_t</span>			sk_stamp;</span><br><span class="line">	u16			sk_tsflags;</span><br><span class="line">	u32			sk_tskey;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">socket</span>		*<span class="title">sk_socket</span>;</span></span><br><span class="line">	<span class="keyword">void</span>			*sk_user_data;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">page_frag</span>	<span class="title">sk_frag</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sk_buff</span>		*<span class="title">sk_send_head</span>;</span></span><br><span class="line">	__s32			sk_peek_off;</span><br><span class="line">	<span class="keyword">int</span>			sk_write_pending;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SECURITY</span></span><br><span class="line">	<span class="keyword">void</span>			*sk_security;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">	__u32			sk_mark;</span><br><span class="line">	u32			sk_classid;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cg_proto</span>		*<span class="title">sk_cgrp</span>;</span></span><br><span class="line">	<span class="keyword">void</span>			(*sk_state_change)(struct sock *sk);</span><br><span class="line">	<span class="keyword">void</span>			(*sk_data_ready)(struct sock *sk);</span><br><span class="line">	<span class="keyword">void</span>			(*sk_write_space)(struct sock *sk);</span><br><span class="line">	<span class="keyword">void</span>			(*sk_error_report)(struct sock *sk);</span><br><span class="line">	<span class="keyword">int</span>			(*sk_backlog_rcv)(struct sock *sk,</span><br><span class="line">						  struct sk_buff *skb);</span><br><span class="line">	<span class="keyword">void</span>                    (*sk_destruct)(struct sock *sk);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>通过分析此结构，发现其存有sk_peer_pid字段，我们可以看看关于此字段的说明: sk_peer_pid: &amp;struct pid for this socket’s peer。可以知道，此字段保存的是对端sock所对应的进程PID，所以，针对的是sock为域套接字的情况。并不能代表当前sock的PID。</p>
<p>由此，分析陷入了僵局。</p>
<h1 id="另一种思路"><a href="#另一种思路" class="headerlink" title="另一种思路"></a>另一种思路</h1><p>通过上述分析，发现无法获取发送此sk_buff的进程PID，是否就不能获取到了呢？仔细思考了一番发现，之前的思路完全进入了死胡同。我一直思考由sk_buff找进程，却没有思考过由进程找sk_buff。</p>
<p>在进程通过系统调用(write,send,sendto…)进行数据包发送时，其通过套接字描述符传递给内核，告诉内核此数据包使用哪个套接字发送，其最终的调用如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *	Send a datagram to a given address. We move the address into kernel</span></span><br><span class="line"><span class="comment"> *	space and check the user space data area is readable before invoking</span></span><br><span class="line"><span class="comment"> *	the protocol.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">SYSCALL_DEFINE6(sendto, <span class="keyword">int</span>, fd, <span class="keyword">void</span> __user *, buff, <span class="keyword">size_t</span>, len,</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">int</span>, flags, struct sockaddr __user *, addr,</span><br><span class="line">		<span class="keyword">int</span>, addr_len)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">socket</span> *<span class="title">sock</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_storage</span> <span class="title">address</span>;</span></span><br><span class="line">	<span class="keyword">int</span> err;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">msghdr</span> <span class="title">msg</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">iovec</span> <span class="title">iov</span>;</span></span><br><span class="line">	<span class="keyword">int</span> fput_needed;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (len &gt; INT_MAX)</span><br><span class="line">		len = INT_MAX;</span><br><span class="line">	sock = sockfd_lookup_light(fd, &amp;err, &amp;fput_needed);</span><br><span class="line">	<span class="keyword">if</span> (!sock)</span><br><span class="line">		<span class="keyword">goto</span> out;</span><br><span class="line"></span><br><span class="line">	iov.iov_base = buff;</span><br><span class="line">	iov.iov_len = len;</span><br><span class="line">	msg.msg_name = <span class="literal">NULL</span>;</span><br><span class="line">	msg.msg_iov = &amp;iov;</span><br><span class="line">	msg.msg_iovlen = <span class="number">1</span>;</span><br><span class="line">	msg.msg_control = <span class="literal">NULL</span>;</span><br><span class="line">	msg.msg_controllen = <span class="number">0</span>;</span><br><span class="line">	msg.msg_namelen = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (addr) &#123;</span><br><span class="line">		err = move_addr_to_kernel(addr, addr_len, &amp;address);</span><br><span class="line">		<span class="keyword">if</span> (err &lt; <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">goto</span> out_put;</span><br><span class="line">		msg.msg_name = (struct sockaddr *)&amp;address;</span><br><span class="line">		msg.msg_namelen = addr_len;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (sock-&gt;file-&gt;f_flags &amp; O_NONBLOCK)</span><br><span class="line">		flags |= MSG_DONTWAIT;</span><br><span class="line">	msg.msg_flags = flags;</span><br><span class="line">	err = sock_sendmsg(sock, &amp;msg, len);</span><br><span class="line"></span><br><span class="line">out_put:</span><br><span class="line">	fput_light(sock-&gt;file, fput_needed);</span><br><span class="line">out:</span><br><span class="line">	<span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由此可以知道，通过sock = sockfd_lookup_light(fd, &amp;err, &amp;fput_needed);即可找到fd对应的sock。</p>
<p>所以，我们可以通过遍历系统中所有的进程，并遍历进程打开的文件，通过文件过滤出sock类型的文件，找到进程所有的sock，并将sock与sk_buff里面的sock进行对比，如果是相同的sock，那么就得到了此sk_buff对应的进程了，此时进程的所有信息都能过获取到了(包括进程PID)。</p>
<h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><p>通过在Netfilter的Localout点挂在钩子，获取由系统发出的所有数据包，进行查找此发送数据包的进程。代码如下(基于linux 3.18.24内核)：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/ctype.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/netdevice.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/netfilter.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/netfilter_ipv4.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/skbuff.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/sched.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/fs.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/fdtable.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/net.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/file.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> _local_out_ipv4(</span><br><span class="line">    <span class="keyword">const</span> struct nf_hook_ops *ops,</span><br><span class="line">    struct sk_buff *skb,</span><br><span class="line">    <span class="keyword">const</span> struct net_device *in,</span><br><span class="line">    <span class="keyword">const</span> struct net_device *out,</span><br><span class="line">    <span class="keyword">int</span> (*okfn)(struct sk_buff *))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sock</span>* <span class="title">sk</span> = <span class="title">skb</span>-&gt;<span class="title">sk</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">p</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">socket</span> *<span class="title">sock</span> = <span class="title">NULL</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">files_struct</span> *<span class="title">files</span> = <span class="title">NULL</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">file</span> *<span class="title">file</span> = <span class="title">NULL</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fdtable</span> *<span class="title">fdt</span> = <span class="title">NULL</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fd</span> <span class="title">f</span>;</span></span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">int</span> err = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(sk) &#123;</span><br><span class="line">        rcu_read_lock();</span><br><span class="line">        for_each_process(p) &#123;</span><br><span class="line">            task_lock(p);</span><br><span class="line">            files = p-&gt;files;</span><br><span class="line">            <span class="keyword">if</span>(!files) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            fdt = rcu_dereference_raw(files-&gt;fdt);</span><br><span class="line">            <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;fdt-&gt;max_fds; i++) &#123;</span><br><span class="line">                file = rcu_dereference_raw(fdt-&gt;fd[i]);</span><br><span class="line">                f = __to_fd((<span class="keyword">unsigned</span> <span class="keyword">long</span>)file);</span><br><span class="line">                <span class="keyword">if</span>(f.file) &#123;</span><br><span class="line">                    sock = sock_from_file(f.file, &amp;err);</span><br><span class="line">                    <span class="keyword">if</span>(sock) &#123;</span><br><span class="line">                        <span class="keyword">if</span>(sock-&gt;sk == sk) &#123;</span><br><span class="line">                            pid = p-&gt;pid;</span><br><span class="line">                            printk(<span class="string">"This Pkt from pid [%d]!\n"</span>, pid);</span><br><span class="line">                            task_unlock(p);</span><br><span class="line">                            <span class="keyword">goto</span> ok;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            task_unlock(p);</span><br><span class="line">        &#125;</span><br><span class="line">ok:</span><br><span class="line">        rcu_read_unlock();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> NF_ACCEPT;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">nf_hook_ops</span> <span class="title">my_hook_ops</span>[] = &#123;</span></span><br><span class="line">    &#123;</span><br><span class="line">        .hook = _local_out_ipv4,</span><br><span class="line">        .owner = THIS_MODULE,</span><br><span class="line">        .pf = NFPROTO_IPV4,</span><br><span class="line">        .hooknum = NF_INET_LOCAL_OUT,</span><br><span class="line">        .priority = NF_IP_PRI_LAST,</span><br><span class="line">    &#125;,      </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> __<span class="function">init <span class="title">my_hook_init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	nf_register_hooks(my_hook_ops, ARRAY_SIZE(my_hook_ops));</span><br><span class="line">	printk(<span class="string">"hook init+++++++++++++++++++++++++++++++++++++++++\n"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __<span class="function"><span class="built_in">exit</span> <span class="title">my_hook_exit</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	nf_unregister_hooks(my_hook_ops, ARRAY_SIZE(my_hook_ops));</span><br><span class="line">	printk(<span class="string">"hook exit\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(my_hook_init);</span><br><span class="line">module_exit(my_hook_exit);</span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">"GPL"</span>);</span><br><span class="line">MODULE_AUTHOR(<span class="string">"JeanP"</span>);</span><br></pre></td></tr></table></figure>
<p>编译，插入模块，通过dmesg可以看到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[24266.003395] [HOOK]	This Pkt from pid [1557]!</span><br><span class="line">[24266.036238] [HOOK]	This Pkt from pid [1557]!</span><br><span class="line">[24266.068725] [HOOK]	This Pkt from pid [1557]!</span><br><span class="line">[24266.101837] [HOOK]	This Pkt from pid [1557]!</span><br><span class="line">[24266.134864] [HOOK]	This Pkt from pid [1557]!</span><br></pre></td></tr></table></figure>
<p>由此可知，上述的这几个数据包都是从进程PID为1557发送出来的。</p>
<p>通过，pstree -p 可以看到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">├─sshd(1198)─┬─sshd(1557)───bash(1762)</span><br><span class="line">│            └─sshd(38305)───bash(38521)───pstree(38534)</span><br></pre></td></tr></table></figure>
<p>对比可知，dmesg看到的几个包都是由sshd发送出来的SSH报文。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>通过上述探索过程，发现遇到问题时，有时候换一种思路，或许能很快的解决。</p>
<p>上述实现代码，仅作参考，实际上并不提倡这样用，因为针对每个sk_buff，都遍历了系统中所有进程打开的文件，如果流量大，进程多，打开的文件数多，那么效率是相当低的。实际开发中，如果有这样的需求，应当建立自己的哈希表，根据数据包的源IP、源端口以及协议类型(TCP or UDP)进行哈希，从哈希表找到相应的进程，如果找不到，再遍历进程树，进而保存。然后再维护哈希表的超时机制即可。这样效率就比原来的要高得多了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/19/怎样在Buildroot中添加自定义的package/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="弈心">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="弈心">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/19/怎样在Buildroot中添加自定义的package/" itemprop="url">怎样在Buildroot中添加自定义的package</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-19T11:22:38+08:00">
                2017-10-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Buildroot介绍"><a href="#Buildroot介绍" class="headerlink" title="Buildroot介绍"></a>Buildroot介绍</h2><h3 id="下面是官方介绍"><a href="#下面是官方介绍" class="headerlink" title="下面是官方介绍"></a>下面是官方介绍</h3><p>Buildroot is a tool that simplifies and automates the process of building a complete Linux system for an embedded system, using cross-compilation.</p>
<p>In order to achieve this, Buildroot is able to generate a cross-compilation toolchain, a root filesystem, a Linux kernel image and a bootloader for your target. Buildroot can be used for any combination of these options, independently (you can for example use an existing cross-compilation toolchain, and build only your root filesystem with Buildroot).</p>
<p>Buildroot is useful mainly for people working with embedded systems. Embedded systems often use processors that are not the regular x86 processors everyone is used to having in his PC. They can be PowerPC processors, MIPS processors, ARM processors, etc.</p>
<p>Buildroot supports numerous processors and their variants; it also comes with default configurations for several boards available off-the-shelf. Besides this, a number of third-party projects are based on, or develop their BSP  or SDK on top of Buildroot.</p>
<p>Buildroot是一种工具，可简化并自动化使用交叉编译构建嵌入式系统的完整Linux系统的过程。</p>
<p>为了实现这一点，Buildroot能够为您的目标生成交叉编译工具链，根文件系统，Linux内核映像和引导加载程序。 Buildroot可以独立使用这些选项的任意组合（您可以使用现有的交叉编译工具链，并使用Buildroot构建您的根文件系统）。</p>
<p>Buildroot主要用于使用嵌入式系统的人员。嵌入式系统通常使用的处理器不是所有人习惯在其PC中使用的常规x86处理器。它们可以是PowerPC处理器，MIPS处理器，ARM处理器等。</p>
<p>Buildroot支持众多处理器及其变体;它还具有可用于现成的多个板的默认配置。除此之外，还有一些第三方项目基于或开发了其在Buildroot之上的BSP或SDK。</p>
<h2 id="获取Buildroot源码"><a href="#获取Buildroot源码" class="headerlink" title="获取Buildroot源码"></a>获取Buildroot源码</h2><p>Buildroot下载(<a href="https://buildroot.org/downloads/" target="_blank" rel="noopener">https://buildroot.org/downloads/</a>)</p>
<h2 id="Buildroot源码目录结构"><a href="#Buildroot源码目录结构" class="headerlink" title="Buildroot源码目录结构"></a>Buildroot源码目录结构</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+-- arch/ 	存放体系相关的配置文件</span><br><span class="line">+-- board/  	存放各类型具体芯片相关的配置文件</span><br><span class="line">+-- boot/	存放各类型具体芯片相关的系统引导程序的配置文件</span><br><span class="line">+-- configs/	一些配置</span><br><span class="line">+-- dl/		package下载存放的路径</span><br><span class="line">+-- docs/	存放文档</span><br><span class="line">+-- fs/		存放文件系统相关配置</span><br><span class="line">+-- linux/  	存放linux相关配置</span><br><span class="line">+-- output/ 	编译输出路径</span><br><span class="line">+-- package/	存放各软件包</span><br><span class="line">+-- support/	存放编译过程中所依赖的包	</span><br><span class="line">+-- system/	存放跟系统相关的配置（包括原始的根文件系统）</span><br><span class="line">+-- toolchain/	存放工具链相关</span><br></pre></td></tr></table></figure>
<h2 id="Buildroot简单使用"><a href="#Buildroot简单使用" class="headerlink" title="Buildroot简单使用"></a>Buildroot简单使用</h2><p><strong>重要提示</strong>：你应当以普通用户进行编译操作。没有必要使用root来配置和使用Buildroot。通过以普通用户身份运行所有命令，可以在编译和安装过程中保护系统免受软件包性能的影响。</p>
<p>使用Buildroot的第一步是创建一个配置。 Buildroot有一个很好的配置工具，类似于您可以在Linux内核或BusyBox中找到的配置工具。</p>
<p>从buildroot目录运行</p>
<p> $ make menuconfig<br>对于原来基于curses的配置器，或者</p>
<p> $ make nconfig<br>对于新的基于curses的配置器，或者</p>
<p> $ make xconfig<br>对于基于Qt的配置器，或者</p>
<p> $ make gconfig<br>为基于GTK的配置器。</p>
<p>所有这些“make”命令都需要构建配置实用程序（包括接口），因此您可能需要为配置实用程序使用的相关库安装“开发”软件包。</p>
<p>配置完成后，配置工具将生成包含整个配置的.config文件。该文件将被顶级Makefile读取。</p>
<p>要开始构建过程，只需运行：</p>
<p> $ make<br><strong>注意</strong>：不应该在Buildroot中使用make -jN：目前不支持顶级并行make。而是使用BR2_JLEVEL选项来告诉Buildroot，使用make -jN来运行每个包的编译。</p>
<p>这些命令，使menuconfig | nconfig | gconfig | xconfig和make是基本的命令，可以轻松快速地生成需要的映像，以及启用的所有功能和应用程序。</p>
<h2 id="在Buildroot中添加自己的包"><a href="#在Buildroot中添加自己的包" class="headerlink" title="在Buildroot中添加自己的包"></a>在Buildroot中添加自己的包</h2><p>Buildroot自身存放了足够多的包，在源码的package目录下，每个包都包含了相关的配置文件，当配置选中时，Buildroot将通过该包的配置文件，选择从Internet或本地获取包源码，并进行编译。因此，你可以通过配置，为你的目标包含所需要的包即可。有时，我们想为目标添加我们自己的包，这时候，我们就得在package目录下添加包的相关配置了。下面，以helloworld包为例，简单演示如何将helloworld包添加到Buildroot中。</p>
<h3 id="helloworld包源码及路径"><a href="#helloworld包源码及路径" class="headerlink" title="helloworld包源码及路径"></a>helloworld包源码及路径</h3><p>通过以下操作，创建我们的helloworld包：</p>
<ol>
<li>在Buildroot源码顶级目录新建我们自己的目录，命名为：mywork</li>
<li>在mywork目录下新建helloworld目录</li>
<li>在helloworld目录下新建helloworld.c文件</li>
<li>编辑helloworld.c，保存如下：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char** argv) </span><br><span class="line">&#123;</span><br><span class="line">	printf(&quot;Hello world!\n&quot;);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时，Buildroot源码树变为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">+-- arch/ 	存放体系相关的配置文件</span><br><span class="line">+-- board/  	存放各类型具体芯片相关的配置文件</span><br><span class="line">+-- boot/	存放各类型具体芯片相关的系统引导程序的配置文件</span><br><span class="line">+-- configs/	一些配置</span><br><span class="line">+-- dl/		package下载存放的路径</span><br><span class="line">+-- docs/	存放文档</span><br><span class="line">+-- fs/		存放文件系统相关配置</span><br><span class="line">+-- linux/  	存放linux相关配置</span><br><span class="line">+-- mywork/	存放我们自定义的相关包</span><br><span class="line">|   +-- helloworld/	helloworld包</span><br><span class="line">|       +-- helloworld.c helloworld包源代码文件</span><br><span class="line">+-- output/ 	编译输出路径</span><br><span class="line">+-- package/	存放各软件包</span><br><span class="line">+-- support/	存放编译过程中所依赖的包	</span><br><span class="line">+-- system/	存放跟系统相关的配置（包括原始的根文件系统）</span><br><span class="line">+-- toolchain/	存放工具链相关</span><br></pre></td></tr></table></figure>
<h3 id="为helloworld包添加配置文件"><a href="#为helloworld包添加配置文件" class="headerlink" title="为helloworld包添加配置文件"></a>为helloworld包添加配置文件</h3><ol>
<li>通过上面的介绍可知，要将我们的helloworld包编译进我们的目标中，需要在源码的package目录中添加相应的配置文件才行，因此，在package目录下，新建helloworld文件夹，并在helloworld文件夹下，创建Config.in与helloworld.mk文件，并编辑这两个文件，使其内容分别为：<br><strong>Config.in</strong>文件内容：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">menu &quot;Hello World&quot;</span><br><span class="line">        config BR2_PACKAGE_HELLOWORLD</span><br><span class="line">            bool &quot;helloworld&quot;</span><br><span class="line">            default n</span><br><span class="line">            help</span><br><span class="line">                Hello world.</span><br><span class="line"></span><br><span class="line">        config BR2_PACKAGE_HELLOWORLD_DIR</span><br><span class="line">            string &quot;Directory name for Hello World code&quot;</span><br><span class="line">            depends on BR2_PACKAGE_HELLOWORLD</span><br><span class="line">            default &quot;helloworld&quot;</span><br><span class="line"></span><br><span class="line">endmenu</span><br></pre></td></tr></table></figure>
<p>Config.in文件的主要作用是使得在Buildroot的配置菜单中显示出我们新加的东西。在这里，我们定义了两个变量，一个Bool的BR2_PACKAGE_HELLOWORLD，表示是否编译Helloworld；一个字串的BR2_PACKAGE_HELLOWORLD_DIR，表示main.c所在的文件夹。</p>
<p><strong>helloworld.mk</strong>文件内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">HELLOWORLD_VERSION:= 1.0</span><br><span class="line">HELLOWORLD_SITE:= $(BR2_MYWORK_OBJECT_DIR)/$(BR2_PACKAGE_HELLOWORLD_DIR)</span><br><span class="line">HELLOWORLD_SITE_METHOD:=local</span><br><span class="line">HELLOWORLD_INSTALL_TARGET:=YES</span><br><span class="line"></span><br><span class="line">define HELLOWORLD_BUILD_CMDS</span><br><span class="line">        $(MAKE) CC=&quot;$(TARGET_CC)&quot; LD=&quot;$(TARGET_LD)&quot; -C $(@D) all</span><br><span class="line">endef</span><br><span class="line"></span><br><span class="line">define HELLOWORLD_INSTALL_TARGET_CMDS</span><br><span class="line">        $(MAKE) INSTALL=&quot;$(INSTALL)&quot; DESTDIR=&quot;$(TARGET_DIR)&quot;  -C $(@D) install</span><br><span class="line">endef</span><br><span class="line"></span><br><span class="line">$(eval $(generic-package))</span><br></pre></td></tr></table></figure>
<p>Helloworld.mk定义了模块的代码获取方式、编译方式和安装方式。<br>HELLOWORLD_VERSION表示版本；<br>HELLOWORLD_SITE表示源码位置；<br>HELLOWORLD_SITE_METHOD表示源码获取方式，由于是本地代码，所以是local；<br>HELLOWORLD_INSTALL_TARGET表示是否安装到嵌入式目标系统中；<br>HELLOWORLD_BUILD_CMDS表示编译方式；<br>HELLOWORLD_INSTALL_TARGET_CMDS表示安装方式；</p>
<ol start="2">
<li>要将helloworld编译进我们的目标中，还需要修改package目录下的Config.in文件，使其包含我们的helloworld包，为此，我们在其中添加如下代码：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">menu &quot;My Work&quot;</span><br><span class="line">    config BR2_MYWORK_OBJECT_DIR</span><br><span class="line">      string  &quot;My work Directory&quot;</span><br><span class="line">        default &quot;mywork&quot;</span><br><span class="line">      help</span><br><span class="line">        path to my work</span><br><span class="line">    source &quot;package/helloworld/Config.in&quot;</span><br><span class="line">endmenu</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>为我们的helloworld包创建Makefile，在Buildroot源码的mywork/helloworld目录下创建Makefile文件,并修改使其内容为：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">all: helloworld</span><br><span class="line"></span><br><span class="line">helloworld.o:helloworld.c</span><br><span class="line">	$(CC) -c helloworld.c</span><br><span class="line"></span><br><span class="line">helloworld: helloworld.o</span><br><span class="line">	$(CC) -o helloworld helloworld.o</span><br><span class="line"></span><br><span class="line">clean:</span><br><span class="line">	rm -rf *.o</span><br><span class="line">	rm -rf helloworld</span><br><span class="line"></span><br><span class="line">install:</span><br><span class="line">	$(INSTALL) -D -m 0755 helloworld $(TARGET_DIR)/usr/bin</span><br></pre></td></tr></table></figure>
<p>至此，所有的配置都已完成，Buildroot源码树变为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">+-- arch/ 	存放体系相关的配置文件</span><br><span class="line">+-- board/  	存放各类型具体芯片相关的配置文件</span><br><span class="line">+-- boot/	存放各类型具体芯片相关的系统引导程序的配置文件</span><br><span class="line">+-- configs/	一些配置</span><br><span class="line">+-- dl/		package下载存放的路径</span><br><span class="line">+-- docs/	存放文档</span><br><span class="line">+-- fs/		存放文件系统相关配置</span><br><span class="line">+-- linux/  	存放linux相关配置</span><br><span class="line">+-- mywork/	存放我们自定义的相关包</span><br><span class="line">|   +-- helloworld/	helloworld包</span><br><span class="line">|       +-- helloworld.c helloworld包源代码文件</span><br><span class="line">|       +-- Makefile		helloworld包的Makefile</span><br><span class="line">+-- output/ 	编译输出路径</span><br><span class="line">+-- package/	存放各软件包</span><br><span class="line">|   +-- Config.in 	定义所有包的菜单配置</span><br><span class="line">|   +-- helloworld/	包含helloworld包相关配置</span><br><span class="line">|       +-- Config.in	定义helloworld包的菜单配置</span><br><span class="line">|       +-- helloworld.mk	定义helloworld包的编译方式</span><br><span class="line">+-- support/	存放编译过程中所依赖的包	</span><br><span class="line">+-- system/	存放跟系统相关的配置（包括原始的根文件系统）</span><br><span class="line">+-- toolchain/	存放工具链相关</span><br></pre></td></tr></table></figure>
<p>现在，我们可以通过make menuconfig选中我们的helloworld包进行配置了，通过make命令，就可以编译出我们的helloworld包了，编译完成后，可以在Buildroot的output/tackage/usr/bin/目录下找到我们的helloworld文件。</p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>Buildroot是一套强大的工具，使用它，你会从中体会到很多很多的乐趣。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/19/如何给宝宝添加辅食/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="弈心">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="弈心">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/19/如何给宝宝添加辅食/" itemprop="url">如何给宝宝添加辅食</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-19T11:22:34+08:00">
                2017-10-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="宝宝添加辅食的方法"><a href="#宝宝添加辅食的方法" class="headerlink" title="宝宝添加辅食的方法"></a>宝宝添加辅食的方法</h1><h2 id="泥类辅食"><a href="#泥类辅食" class="headerlink" title="泥类辅食"></a>泥类辅食</h2><ul>
<li><strong>果泥</strong>：将水果洗净去皮，去核，切成碎块状，加适量糖，隔水蒸烂，搅拌成泥。</li>
<li><strong>苹果泥</strong>：苹果切开，用匙轻轻刮下泥状物即可。</li>
<li><strong>香蕉泥</strong>：香蕉去皮在盆内用匙搅烂即成香蕉泥。</li>
<li><strong>蔬菜泥</strong>：蔬菜洗净切碎，加少许水，略调味，在锅内焖烂。</li>
<li><strong>红枣泥</strong>：枣洗净后煮约20分钟，去核去皮压成泥。</li>
<li><strong>南瓜泥</strong>：南瓜洗净去皮，蒸熟压碎。</li>
<li><strong>苹果胡萝卜泥</strong>：果菜各半洗净，苹果去皮去核切碎，胡萝卜煮熟挤压，倒入碎苹果煮烂，加适量蜂蜜搅匀。</li>
<li><strong>菜泥</strong>：取适量的新鲜无农药污染的绿叶蔬菜，如小白菜，小青菜等，洗净，捣碎，去掉菜筋，和菜汁一起放入锅中，加适量的植物油与食盐，煮熟，即成菜泥，晾温后，可用小勺喂宝宝吃，菜泥含有较多的维生素、矿物质，是母乳中尤其产后6个月后的母乳中所缺少的，对帮助宝宝消化，防止大便干燥，减少肠道毒素，多有益处。</li>
<li><strong>肉沫</strong>：选用新鲜的瘦肉(猪肉、牛肉、羊肉、鸡肉均可)，剁成肉沫，加调味品上锅蒸烂，研成细沫即可。</li>
<li><strong>鱼泥</strong>：将收拾好的鲜鱼切成小块后放入水中加少量盐煮，除去鱼刺、鱼皮后，将鱼肉研碎，再放入锅内加鱼汤煮，把淀粉调匀后放入锅内，煮至糊状即可。也可从红烧鱼上挑取鱼肉制作，可将鱼泥加入稀粥中一起喂给孩子吃。鱼肉中含有丰富的蛋白质、脂肪及钙、磷、锌等，并且易消化。　　</li>
<li><strong>血豆腐泥</strong>：将动物血洗净，以少量姜、葱末和盐拌匀蒸熟捣碎。</li>
<li><strong>肝泥</strong>：把猪肝或鸡肝洗净放在水中煮，除去血水后换水煮10分钟左右，把肝外皮剥去，用勺子研成泥状，再加适量的盐、酱油和香油搅匀，隔水旺火蒸约25分钟即可。动物肝脏含高蛋白质、磷和铁，有补血、促进脑发育的作用，可预防贫血、佝偻病、营养不良等疾病。</li>
<li><strong>肉末</strong>：取适量的新鲜瘦猪肉，洗净剁成细末，加盐和调料，蒸熟或炒熟，每隔3天-5天喂1次。瘦猪肉中含动物蛋白质多，脂肪少，加之烹饪得法，细嫩，味道香美，容易被宝宝接受。</li>
<li><strong>蔬菜猪肝泥</strong>：猪肝25克、洋葱、西红柿和菠菜叶共30克。猪肝洗净去筋膜后剁成泥。蔬菜择洗净切碎，将肝和菜放入适量肉汤中煮沸加盐搅匀。</li>
</ul>
<h2 id="羹类辅食"><a href="#羹类辅食" class="headerlink" title="羹类辅食"></a>羹类辅食</h2><ul>
<li><strong>鸡蛋羹</strong>：生鸡蛋一个打入碗中，加一小杯开水及适量盐、香油、味精等搅拌，搅拌后放锅里蒸5分钟即可。以鸡蛋刚好凝固又很嫩最适度，蒸的时间过长，以至出蜂窝孔状，这样的蛋羹质硬，不好消化。鸡蛋羹可直接用小勺喂给宝宝吃，软嫩可口，营养价值高，含丰富的蛋白质、脂肪，尤其是蛋黄中含有卵磷脂及铁、钙、磷、维生素A、D、B等，可营养大脑，又能满足婴儿对铁的需要。</li>
<li><strong>鱼菜蛋羹</strong>：鱼：菠菜：鸡蛋=1：1：2。鱼剖洗净剔除骨刺剁成泥，菠菜择洗净切成碎末置鱼碗中，鸡蛋洗净磕入碗中加温开水搅匀，加到盛有鱼和菜的碗中加一点盐搅匀，隔水蒸约5分钟。</li>
<li><strong>绿豆羹</strong>：绿豆淘洗净，加8倍于绿豆量的水煮5分钟再用小火将豆焖烂，加适量糖、30克琼脂搅匀。</li>
</ul>
<h2 id="粥类辅食"><a href="#粥类辅食" class="headerlink" title="粥类辅食"></a>粥类辅食</h2><ul>
<li><strong>米粥</strong>：小米、大米、高梁均可，但最好在做前用水泡上1小时，煮时易烂，粥的稠度根据孩子大小、消化能力不同由稀到稠。</li>
<li><strong>青菜粥</strong>：可将粥煮烂，在停火前加入洗净切碎的青菜心、盐适量搅匀，再煮10分钟左右即可食用。青菜可选用菠菜、白菜、油菜等等。</li>
<li><strong>鸡肝粥</strong>：鸡肝放沸水中煮熟后，换水续煮10分钟捞出去皮压成泥，放回锅中加酱油白糖搅匀烧沸即成</li>
<li><strong>肉蛋豆腐粥</strong>：猪肉20克、鸡蛋半个、豆腐20克、米30克。肉洗净剁为泥，鸡蛋搅打均匀，豆腐洗净压碎。米洗净加适量水煮至八成熟下肉泥煮至肉熟，将豆腐和蛋液倒入锅中，旺火煮至蛋熟下盐搅匀。</li>
</ul>
<h2 id="另外推荐几种辅食"><a href="#另外推荐几种辅食" class="headerlink" title="另外推荐几种辅食"></a>另外推荐几种辅食</h2><ul>
<li><strong>牛奶藕粉</strong>：适合4个月以上宝宝。将藕粉、水、奶一起放入锅内，均匀混合后用微火煮，搅至透明糊状为止。宝宝很喜欢吃，注意不要给宝宝吃太多了。 </li>
<li><strong>乌龙面糊</strong>：适合4-6个月宝宝。材料：乌龙面10克、水1/2杯、蔬菜泥少量。做法：乌龙面倒入沸水中煮至熟软捞起备用。煮熟的乌龙面与水同时倒入小锅内捣烂，煮开。起锅后加入少量蔬菜泥即可。 </li>
<li><strong>蛋黄粥</strong>：适合5-6个月宝宝。用料：适量，肉汤(或鱼汤、菜汤)适量。做法：当煮大人饭时，放了米及水在煲内，用汤匙在中心挖一洞，使中心的米多些水，煮成饭后，中心的米便成软饭，把适量的软饭搓成糊状。把适量的汤隔去渣，如鱼汤要特别小心以防有鱼骨。除去汤面的油。把汤及饭糊放入小煲内煲滚，用慢火煲成稀糊状，放入极少量的盐调味，然后放下1／4只熟鸡蛋黄(要搓成茸)搅匀煮滚，盛入碗中。待温度适合时，便可喂婴儿。大人的汤不适宜婴儿食用的话，可以用牛奶或水煮成稀糊，必须煮成极烂的稀糊，否则，婴儿难消化。</li>
<li><strong>豆腐蛋黄粥</strong>：适合5-6个月宝宝。材料：豆腐1小块，蛋黄1/2个，粥半小碗。做法：豆腐压成碎泥状，鸡蛋煮熟后，取出1/2个蛋黄压碎。粥放入锅中，加上豆腐泥，煮开后撒下蛋黄，用勺搅匀，待粥再开即可熄火。</li>
<li><strong>红薯粥</strong>：适合5-6个月宝宝。材料：米1大匙，洗净浸于水中1小时以上。红薯1/2大匙，去皮切0.5公分小薄丁。水 5大匙。作法：米和红薯放入锅内加水煮。煮沸，转小火，再煮25-30分钟种，粥烂即可。 </li>
<li><strong>青菜面</strong>：适合5-6个月宝宝。材料：龙须面15根、高汤(鸡汤，骨头汤，蔬菜汤)1杯、青菜叶2片。做法：龙须面掰碎(越碎越好)，青菜叶洗干净切碎。锅内放入高汤煮开，下入面条。中火将面条煮烂，加入青菜末。再次沸腾即可关火，盖锅盖焖5分钟。加入1滴香油和1滴酱油调味。</li>
<li><strong>红嘴绿鹦哥丝面</strong>：适合7-8个月宝宝。原料：西红柿一个或半个、菠菜叶几根、豆腐一小块、排骨汤半碗、细细面条一把。做法：将西红柿用开水烫一下，去掉皮，切成碎块，备用。菠菜叶(嫩的)洗净，切碎，备用。豆腐切碎，备用。将锅内放入少许油，用切碎的葱花呛锅，(也可不用葱花和和油)再倒入排骨汤，烧沸。将西红柿和菠菜叶倒入锅内，略开一会儿。再加入非常细的面条，面条软即可出锅。特点：条软软的，汤酸酸的，又有肉味，表面飘着绿绿的、红红的、白白的，很有食欲；原料常见，容易齐备，变化多样，可随季节和自己的喜好随意更换为黄瓜、小油菜、白菜，也可放一些宝宝能吃的软软的肉或打上一个鸡蛋(搅开)，也可用虾仁；操作简单，一看就会。</li>
<li><strong>鱼肉松粥</strong>：适合7-8个月宝宝。原料：大米一两，鱼肉松半两，菠菜半两，精盐少许，清水适量。制作：将大米淘洗干净，放入锅内，倒入清水用旺火煮开，改微火熬至粘稠待用(注意粥要熬烂、熬粘)。将菠菜洗净，用开水烫一下，切成碎末，放入粥内，加入鱼肉松、精盐，调好口味，用微火熬几分钟即成。特点：粥粘稠，味鲜而香。此粥富含优质蛋白质、碳水化合物及钙、磷、铁和维生素等，是补充蛋白质和钙质的良好来源。</li>
</ul>
<h2 id="婴儿小食品制作："><a href="#婴儿小食品制作：" class="headerlink" title="婴儿小食品制作："></a>婴儿小食品制作：</h2><ol>
<li><strong>肉面条</strong>:<br>把面条放入热水中煮后切成小段，和2小匙猪肉末一起放入锅内，加海味汤后用微火煮，再加适量酱油，把淀粉用水调匀后倒入锅内搅拌均匀后停火。 </li>
<li><strong>虾糊</strong>:<br>把虾剥去外壳，洗干净后用开水煮片刻，然后研碎，再放入锅内加肉汤煮，煮熟后加入用水调匀的淀粉和少量盐，使其呈糊状后停火。 </li>
<li><strong>奶油鱼</strong>:<br>把洗净的鱼放热水中煮后研碎，把酱油倒入锅内加少量肉汤，再将切碎的鱼肉上火煮，边煮边搅拌，煮好后放入少许奶油和切碎的芹菜即可。 </li>
<li><strong>煮白薯</strong>:<br>把白薯洗净去皮后切成薄片，把苹果洗净去皮去核后也切成薄片，然后把白薯和苹果片先后放入锅内，加少许水后用微火煮，煮好后加少许冰糖。 </li>
<li><strong>疙瘩汤</strong>:<br>把1/4个鸡蛋和少量水放入大匙面粉中，用筷子搅拌成小疙瘩，把切碎的胡萝卜、圆白菜各两小匙放入肉汤内煮软后，再把面疙瘩一点一点放入肉汤中煮。 </li>
<li><strong>蒸鱼饼</strong>:<br>把1/2条鱼去皮和骨、刺后，研碎；与豆腐泥混合均匀后做成小饼，放蒸锅内蒸，把鱼汤煮开后加少许盐，最后把蒸过的鱼饼放入鱼汤内煮熟。<br>蒸鱼饼的特点是能够保持鱼肉中的营养成分不被破坏。 </li>
<li><strong>虾豆腐</strong>:<br>虾2条，豆腐一小块，嫩豌豆苗2、3根煮熟后切碎，放入锅内，再加切碎的生香菇，加海味汤煮，熟时薄薄的勾一点芡。</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/19/利用zlib解压http中gzip数据/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="弈心">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="弈心">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/19/利用zlib解压http中gzip数据/" itemprop="url">利用zlib解压http中gzip数据</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-19T11:22:31+08:00">
                2017-10-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="什么是GZIP"><a href="#什么是GZIP" class="headerlink" title="什么是GZIP"></a>什么是GZIP</h1><p>GZIP是一种文件压缩算法，其应用范围广，GZIP压缩的比率往往在3到10倍，也就是本来90k大小的页面，采用压缩后实际传输的内容大小只有28至30K大小，这可以大大节省服务器的网络带宽，同时如果应用程序的响应足够快时，网站的速度瓶颈就转到了网络的传输速度上，因此内容压缩后就可以大大的提升页面的浏览速度。在传统的http协议中，通过采用gzip压缩技术，将传输的数据经过压缩后发送到对端进行解压缩操作，可以大大的减少web服务器与客户端的流量。http的gzip压缩是由WEB服务器和浏览器之间共同遵守的协议，也就是说WEB服务器和浏览器都必须支持该技术，而现在主流的浏览器都是支持的，包括IE、FireFox、谷歌浏览器、Opera 等。常见的WEB服务器有Apache 和IIS 等。</p>
<h1 id="双方的协商过程如下"><a href="#双方的协商过程如下" class="headerlink" title="双方的协商过程如下"></a>双方的协商过程如下</h1><ol>
<li>首先浏览器请求某个URL 地址，并在请求的头 (head) 中设置属性accept-encoding值为gzip，表明浏览器支持gzip这种压缩方式。</li>
</ol>
<p>（注：gzip是一种数据压缩格式，默认且目前仅使用deflate算法压缩data部分。）</p>
<ol start="2">
<li><p>WEB服务器接收到请求后判断浏览器是否支持压缩，如果支持就传送压缩后的响应内容，否则传送不经过压缩的内容；</p>
</li>
<li><p>浏览器获取响应内容后，判断内容是否被压缩，如果是则解压缩，然后显示响应页面的内容。（IE5.5以上才支持gzip）</p>
</li>
</ol>
<h1 id="HTTP报文分析"><a href="#HTTP报文分析" class="headerlink" title="HTTP报文分析"></a>HTTP报文分析</h1><p>在浏览器收到web服务器的回复时，通过http头部中的Content-Encoding属性，值为gzip，则表明此数据报文是经过gzip压缩的。若http头部中，还包含Transfer-Encoding属性，且其值为trunk时，表明此数据报文是经过gzip压缩后，再封装成trunk格式，一段一段发送过来的，此时，其数据包大小不定，一直到接收到终止trunk为止。</p>
<h1 id="获取HTTP报文的压缩数据"><a href="#获取HTTP报文的压缩数据" class="headerlink" title="获取HTTP报文的压缩数据"></a>获取HTTP报文的压缩数据</h1><ol>
<li>不带chunk:</li>
</ol>
<p>当获取到不带chunk的压缩数据报文，此时http除去头部信息后，剩下的字节数都为待解压的gzip数据。</p>
<ol start="2">
<li>带chunk:</li>
</ol>
<p>当获取到带chunk的压缩数据报文，此时http除去头部信息后,剩下的字节都封装成chunk格式，通过解析一段一段的chunk，最终将里面的数据封装成为带解压的gzip数据。</p>
<p>chunk数据格式为：size\r\ndata\r\n，每个chunk都是以size开头，标示该chunk数据域的长度，size与data之间用\r\n隔开，最后再以\r\n标示该chunk的边界。</p>
<h1 id="解压http报文的gzip数据"><a href="#解压http报文的gzip数据" class="headerlink" title="解压http报文的gzip数据"></a>解压http报文的gzip数据</h1><p>要解压http报文的gzip数据，必须利用zlib库进行解压，解压方式可分为：</p>
<ol>
<li>整体解压：</li>
</ol>
<p>待http报文全部接收完成，再获取其中的gzip数据，将整段gip数据利用zlib库的inflate函数进行解压。</p>
<ol start="2">
<li>分段解压：</li>
</ol>
<p>不等http报文全部接收完成，将当前获取的gzip数据，利用zlib库的inflate函数进行解压。</p>
<p>注：分段解压时，必须保证先后顺序，且分段间必须连续无间断方可。</p>
<h1 id="利用ZLIB库解压HTTP报文中的GZIP数据"><a href="#利用ZLIB库解压HTTP报文中的GZIP数据" class="headerlink" title="利用ZLIB库解压HTTP报文中的GZIP数据"></a>利用ZLIB库解压HTTP报文中的GZIP数据</h1><p>在使用zlib解压gzip数据时，每个完整的gzip数据都对应一个z_stream结构，其具体内容如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">z_stream_s</span> &#123;</span></span><br><span class="line"> </span><br><span class="line">    z_const Bytef *next_in;     <span class="comment">/* next input byte */</span></span><br><span class="line"> </span><br><span class="line">    uInt     avail_in;  <span class="comment">/* number of bytes available at next_in */</span></span><br><span class="line"> </span><br><span class="line">    uLong    total_in;  <span class="comment">/* total number of input bytes read so far */</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    Bytef    *next_out; <span class="comment">/* next output byte should be put there */</span></span><br><span class="line"> </span><br><span class="line">    uInt     avail_out; <span class="comment">/* remaining free space at next_out */</span></span><br><span class="line"> </span><br><span class="line">    uLong    total_out; <span class="comment">/* total number of bytes output so far */</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    z_const <span class="keyword">char</span> *msg;  <span class="comment">/* last error message, NULL if no error */</span></span><br><span class="line"> </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">internal_state</span> <span class="title">FAR</span> *<span class="title">state</span>;</span> <span class="comment">/* not visible by applications */</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    alloc_func zalloc;  <span class="comment">/* used to allocate the internal state */</span></span><br><span class="line"> </span><br><span class="line">    free_func  zfree;   <span class="comment">/* used to free the internal state */</span></span><br><span class="line"> </span><br><span class="line">    voidpf     opaque;  <span class="comment">/* private data object passed to zalloc and zfree */</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">int</span>     data_type;  <span class="comment">/* best guess about the data type: binary or text */</span></span><br><span class="line"> </span><br><span class="line">    uLong   adler;      <span class="comment">/* adler32 value of the uncompressed data */</span></span><br><span class="line"> </span><br><span class="line">    uLong   reserved;   <span class="comment">/* reserved for future use */</span></span><br><span class="line"> </span><br><span class="line">&#125; z_stream;</span><br></pre></td></tr></table></figure>
<p>解压前准备：需要调用inflateInit2对z_stream进行初始化操作。</p>
<p>解压中：必须保证实时更新next_in、next_out、 avail_out等字段，一直到解压完毕为止。</p>
<p>解压完毕：调用inflateEnd进行解压终止操作。</p>
<h1 id="GUNZIP实现"><a href="#GUNZIP实现" class="headerlink" title="GUNZIP实现"></a>GUNZIP实现</h1><ol>
<li>数据结构</li>
</ol>
<p>A. 保存解压状态、解压结果的结构体http_gunzip_ctx_t，各字段如下：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">http_gunzip_buf_t</span>         *out;     <span class="comment">/*保存当前解压输出的数据的链表头节点指针*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">http_gunzip_buf_t</span>        *last_out;  <span class="comment">/*保存当前解压输出的数据的链表尾节点指针*/</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">      <span class="keyword">char</span> *out_buf;                     <span class="comment">/*组装当前解压出的数据的指针*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> out_buf_len;         <span class="comment">/*当前解压出的数据总长度*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> total_out_len;        <span class="comment">/*从开始到现在解压出的数据总长度*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> started;             <span class="comment">/*解压开始标志*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> flush;               <span class="comment">/*解压的flush模式标志*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> redo;               <span class="comment">/*重新解压标志*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> done;               <span class="comment">/*解压完成标志*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> nomem;             <span class="comment">/*解压中内存不足标志*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    z_stream zstream;                 <span class="comment">/*zlib解压所需要的数据结构*/</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">http_gunzip_ctx_t</span>;</span><br></pre></td></tr></table></figure></p>
<p>B.保存解压结果的链表，根据解压的输出字节大小，进行扩展。</p>
<p>在gunzip中，将当前解压状态保存在http_gunzip_ctx_t结构中，链表节点中各字段如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">http_gunzip_buf</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *buf;                        <span class="comment">/*保存解压输出的数据*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> buf_len;            <span class="comment">/*申请的buf的总长度*/</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">http_gunzip_buf</span>* <span class="title">next</span>;</span>       <span class="comment">/*指向下一个节点的指针*/</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">http_gunzip_buf_t</span>;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>接口定义</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">A、初始化</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*参数：ctx 为gunzip所需的http_gunzip_ctx_t结构</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">返回值：0：成功，1：失败*/</span></span><br><span class="line"> </span><br><span class="line">      <span class="function"><span class="keyword">int</span> <span class="title">http_gunzip_inflate_init</span><span class="params">(<span class="keyword">http_gunzip_ctx_t</span> *ctx)</span></span>;</span><br><span class="line">B、解压</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*参数：</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">     ctx 为gunzip所需的http_gunzip_ctx_t结构</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">     zdata为待解压的数据</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">     zdata_size为待解压数据的长度</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">     uzdata为解压输出的数据</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">     uzdata_size为解压输出数据的长度</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">返回值：0：成功，1：失败*/</span></span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">int</span> <span class="title">http_gunzip_inflate</span><span class="params">(<span class="keyword">http_gunzip_ctx_t</span> *ctx,</span></span></span><br><span class="line"><span class="function"><span class="params"> </span></span></span><br><span class="line"><span class="function"><span class="params">             <span class="keyword">char</span>* zdata, <span class="keyword">long</span> zdata_size,</span></span></span><br><span class="line"><span class="function"><span class="params"> </span></span></span><br><span class="line"><span class="function"><span class="params">             <span class="keyword">char</span>** uzdata, <span class="keyword">unsigned</span> <span class="keyword">long</span>* uzdata_size)</span></span>;</span><br><span class="line"> </span><br><span class="line">C、退出</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*参数：ctx 为gunzip所需的http_gunzip_ctx_t结构</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">返回值：无*/</span></span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">void</span> <span class="title">http_gunzip_inflate_exit</span><span class="params">(<span class="keyword">http_gunzip_ctx_t</span> *ctx)</span></span>;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>接口使用与说明</li>
</ol>
<p>先调用初始化接口，将http_gunzip_ctx_t结构进行初始化，继而调用解压函数，即可获取解压输出结果，当所有数据解压完毕，调用退出接口进行相关的清理操作。</p>
<p>注意：解压接口中，uzdata为解压输出结果，用户获取输出，使用完毕之后，必须调用free函数，进行内存回收处理。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">弈心</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">24</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">弈心</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
